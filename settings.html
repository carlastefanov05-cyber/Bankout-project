<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bankout - Account Settings</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f4f7f6; padding: 40px; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { color: #2d3436; margin-bottom: 25px; }
        
        .info-group { margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .label { font-size: 12px; color: #666; text-transform: uppercase; font-weight: 700; }
        .value { font-size: 16px; color: #2d3436; margin-top: 5px; }

        input { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        
        .btn-update { width: 100%; background: #8da18d; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: 700; margin-top: 20px; transition: 0.3s; }
        .btn-update:hover { background: #6d816d; }

        .btn-delete { width: 100%; background: #ff4757; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: 700; margin-top: 20px; }
        
        .back-link { display: block; text-align: center; margin-top: 20px; color: #666; text-decoration: none; font-size: 14px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Account Settings</h2>

    <div class="info-group">
        <div class="label">Username</div>
        <div class="value" id="disp-username">Loading...</div>
    </div>
    <div class="info-group">
        <div class="label">Email Address</div>
        <div class="value" id="disp-email">Loading...</div>
    </div>

    <div class="info-group">
        <div class="label">Phone Number</div>
        <input type="text" id="input-phone" placeholder="Enter phone number">
    </div>
    <div class="info-group">
        <div class="label">Home Address</div>
        <input type="text" id="input-address" placeholder="Enter home address">
    </div>

    <button class="btn-update" onclick="updateProfile()">Save Changes</button>
    
    <hr style="margin: 30px 0; border: 0; border-top: 1px solid #eee;">
    
    <button class="btn-delete" onclick="deleteAccount()">Delete Account Permanently</button>
    
    <a href="dashboard.html" class="back-link">‚Üê Back to Dashboard</a>
</div>

<script>
    const username = localStorage.getItem('username');
    let userId = localStorage.getItem('userId');


    async function loadSettings() {
        if (!username) { window.location.href = 'loginmenu.html'; return; }

        try {
            const res = await fetch(`http://localhost:8080/users/profile/${username}`);
            const user = await res.json();
            
            userId = user.id; 
            document.getElementById('disp-username').innerText = user.username;
            document.getElementById('disp-email').innerText = user.email;
            document.getElementById('input-phone').value = user.phone || "";
            document.getElementById('input-address').value = user.address || "";
        } catch (err) {
            console.error("Error loading settings:", err);
        }
    }

    async function updateProfile() {
        const phone = document.getElementById('input-phone').value;
        const address = document.getElementById('input-address').value;

        const updatedData = {
            name: username,
            phone: phone,
            address: address
        };

        try {
            const res = await fetch(`http://localhost:8080/users/${userId}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(updatedData)
            });

            if (res.ok) {
                alert("Profile successfully updated!");
            } else {
                alert("Update failed. Please check server logs.");
            }
        } catch (err) {
            alert("Error connecting to server.");
        }
    }

    async function deleteAccount() {
        const confirmDelete = confirm("WARNING: This will permanently delete your Bankout account and all funds. Proceed?");
        
        if (confirmDelete) {
            try {
                const res = await fetch(`http://localhost:8080/users/${userId}`, {
                    method: 'DELETE'
                });

                if (res.ok) {
                    alert("Account has been deleted. We are sorry to see you go.");
                    localStorage.clear();
                    window.location.href = 'register.html';
                }
            } catch (err) {
                alert("Delete failed.");
            }
        }
    }

    loadSettings();
</script>

</body>
</html>